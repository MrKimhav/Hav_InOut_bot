<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>របាយការណ៍</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 15px; background: #f0f2f5; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; font-size: 11px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #2AABEE; color: white; }
        .back-btn { padding: 8px 15px; background: #2AABEE; color: white; border: none; border-radius: 5px; }
        #loading { text-align: center; color: #666; }
    </style>
</head>
<body>

    <div class="header">
        <button class="back-btn" onclick="window.location.href='index.html'">⬅️ ថយក្រោយ</button>
        <h3>របាយការណ៍</h3>
    </div>

    <div id="loading">កំពុងទាញទិន្នន័យ... ⏳</div>

    <table id="reportTable" style="display:none;">
        <thead>
            <tr>
                <th>កាលបរិច្ឆេទ</th>
                <th>គោលដៅ</th>
                <th>ចេញ</th>
                <th>ចូល</th>
                <th>លក់</th>
                <th>ជំពាក់</th>
                <th>សង</th>
                <th>ជំពាក់សរុប</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // ១. ដាក់ URL របស់អ្នកនៅទីនេះ (URL តែមួយជាមួយ index.html)
        const scriptURL = "https://script.google.com/macros/s/AKfycbw1CZL_rPXcYLkKe7zNpNk2kXSODuoG22FdCEU0POPx_yZicdoHoOLS478hutjxhrY/exec";

        async function loadData() {
            try {
                const response = await fetch(scriptURL);
                const data = await response.json();

                const tableBody = document.getElementById("tableBody");
                const loading = document.getElementById("loading");
                const table = document.getElementById("reportTable");

                // ២. បង្កើតជួរដេកសម្រាប់ទិន្នន័យនីមួយៗ
data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach((cell, index) => {
        const td = document.createElement("td");
        // ប្រសិនបើជាជួរទី ១ (កាលបរិច្ឆេទ)
        if (index === 0 && cell !== "") {
            const dateObj = new Date(cell);
            // កំណត់ឱ្យបង្ហាញ៖ ថ្ងៃ/ខែ/ឆ្នាំ ម៉ោង:នាទី
            const options = { 
                year: '2-digit', month: 'numeric', day: 'numeric', 
                hour: '2-digit', minute: '2-digit', hour12: true 
            };
            td.innerText = dateObj.toLocaleDateString('km-KH', options);
        } else {
            td.innerText = cell;
        }
        tr.appendChild(td);
    });
    tableBody.appendChild(tr);
});
                loading.style.display = "none";
                table.style.display = "table";

            } catch (error) {
                document.getElementById("loading").innerText = "មិនអាចទាញទិន្នន័យបានទេ៖ " + error.message;
            }
        }

        // ហៅមុខងារទាញទិន្នន័យនៅពេលបើក Page
        loadData();
    </script>
</body>
</html>